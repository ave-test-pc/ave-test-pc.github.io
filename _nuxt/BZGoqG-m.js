import{n as e,df as l,dh as t,gg as a,cC as i,aw as r,D as o,F as n,aj as s,a7 as c,H as d,o as u,w as p,a as m,d as v,t as g,J as b,E as f,K as x,cN as P,bz as w,a8 as h,b as y,M as _,S,aM as I,T,cA as O,dm as L,_ as N,c as k,ap as z,aa as R,bY as C,nS as V,aN as M,a5 as U,ak as F,gh as A,gi as E,aS as D,dk as K,az as j,at as $,a6 as B,di as Y,aJ as q,nT as H,nU as Z,ee as W}from"./C8zCCogY.js";import{a as Q,E as J}from"./C-cIFx6x.js";import"./Dwz_iTym.js";import"./pAvqTbq1.js";import{g as X,d as G,a as ee,C as le,l as te,m as ae,n as ie,u as re,E as oe}from"./jps9OSah.js";import{S as ne}from"./CW8dp4Yv.js";import{E as se,a as ce,b as de}from"./DUtGqHLY.js";import{E as ue}from"./jvqJ-lss.js";import{E as pe}from"./TbcHext3.js";import{E as me}from"./B-JdZO_T.js";const ve={class:"overflow-y-auto scrollbar-hide mx--16px px-16px"},ge={class:"mb-19px flex items-center gap-8px text-14px font-bold color-[--main-text]"},be={class:"flex items-center mb-10px"},fe={class:"flex-1 flex flex-col gap-4px color-[--main-text]"},xe={class:"color-[--third-text]"},Pe={class:"flex-1 flex flex-col gap-4px color-[--main-text]"},we={class:"color-[--third-text]"},he={class:"mb-24px text-12px color-[--yellow]"},ye={class:"flex items-center gap-4px cursor-pointer"},_e={class:"flex items-center gap-10px mt-8px mb-16px"},Se={class:"mt-16px flex items-center gap-4px cursor-pointer"},Ie={class:"flex items-center gap-10px mt-8px mb-16px"},Te={class:"color-[--main-text]"},Oe={class:"mt-16px mb-16px"},Le={class:"mt-53px flex items-center justify-between"},Ne={class:"color-[--third-text]"},ke={class:"mt-16px mb-40px flex items-center justify-between"},ze={class:"color-[--third-text]"},Re={class:"flex"},Ce=N(e({__name:"stopProfitLoss",props:l({row:{}},{visible:{type:Boolean},visibleModifiers:{}}),emits:["update:visible"],setup(e){const l=t(e,"visible"),N=e,k=a(),z=i(),{t:R}=r(),C=n(void 0),V=s({tpPercent:void 0,tpPercent1:void 0,slPercent:void 0,slPercent1:void 0,sizePercent:void 0}),M=s({triggerPrice:void 0,triggerPriceType:"LAST_PRICE",price:void 0,type:"TAKE_PROFIT_MARKET"}),U=s({triggerPrice:void 0,triggerPriceType:"LAST_PRICE",price:void 0,type:"STOP_MARKET"});o(l,e=>{e&&(C.value=void 0,V.tpPercent=void 0,V.tpPercent1=void 0,V.slPercent=void 0,V.slPercent1=void 0,V.sizePercent=void 0,M.triggerPrice=void 0,U.triggerPrice=void 0,M.price=void 0,U.price=void 0)});const F=f(()=>{var e,l;return(null==(e=N.row)?void 0:e.openSize)&&new w((null==(l=N.row)?void 0:l.openSize)||"0").gt(0)}),A=f(()=>{var e,l,t;const a=(null==(t=null==(l=null==(e=k.metadata)?void 0:e.contractList)?void 0:l.reduce)?void 0:t.call(l,(e,l)=>(e[l.contractId]=l.contractName,e),{}))||{};return a.ALL=R("all"),a}),E=f(()=>{var e;return X((null==(e=N.row)?void 0:e.contractId)||"")}),D=f(()=>{var e;return G((null==(e=N.row)?void 0:e.contractId)||"")}),K=f(()=>{var e;return ee((null==(e=N.row)?void 0:e.contractId)||"")||1}),j=f(()=>{var e,l;return(null==(l=le.getSymbolModel((null==(e=N.row)?void 0:e.contractId)||""))?void 0:l.lastPrice)||"0"}),$=f(()=>{var e,l;return new w((null==(e=N.row)?void 0:e.openValue)||0).div((null==(l=N.row)?void 0:l.openSize)||0)}),B=f(()=>{var e;if(w(C.value||0).lte(0)||w(M.triggerPrice||0).lte(0))return"";const l=(null==(e=M.type)?void 0:e.includes("LIMIT"))?M.price:j.value;if(!l)return"";const t=w(M.triggerPrice||0).minus(l).times(C.value||0).abs().dp(2).toFixed();return w(M.triggerPrice||0).gte(l)&&F.value||w(M.triggerPrice||0).lte(l)&&!F.value?R("expectedProfitUSD",{n:t}):R("expectedLossUSD",{n:t})}),Y=f(()=>{var e;if(w(C.value||0).lte(0)||w(U.triggerPrice||0).lte(0))return"";const l=(null==(e=U.type)?void 0:e.includes("LIMIT"))?U.price:j.value;if(!l)return"";const t=w(U.triggerPrice||0).minus(l).times(C.value||0).abs().dp(2).toFixed();return w(U.triggerPrice||0).lt(l)&&F.value||w(U.triggerPrice||0).gt(l)&&!F.value?R("expectedLossUSD",{n:t}):R("expectedProfitUSD",{n:t})}),q=(e,l=0)=>{1===l?V.tpPercent1=Math.min(Math.max(e,0),200):V.tpPercent=e,F.value?M.triggerPrice=new w(e||0).div(100).div(K.value).plus(1).times($.value).dp(E.value,w.ROUND_FLOOR).toNumber():M.triggerPrice=new w(e||0).negated().div(100).div(K.value).plus(1).times($.value).dp(E.value,w.ROUND_FLOOR).toNumber()};const H=(e,l=0)=>{1===l?V.slPercent1=Math.min(Math.max(e,0),200):V.slPercent=e,F.value?U.triggerPrice=new w(e||0).negated().div(100).div(K.value).plus(1).times($.value).dp(E.value,w.ROUND_FLOOR).toNumber():U.triggerPrice=new w(e||0).div(100).div(K.value).plus(1).times($.value).dp(E.value,w.ROUND_FLOOR).toNumber()};const Z=n(!1),W=f(()=>{var e,l;return!C.value||!(M.triggerPrice||U.triggerPrice)||(null==(e=M.type)?void 0:e.includes("LIMIT"))&&!M.price||(null==(l=U.type)?void 0:l.includes("LIMIT"))&&!U.price});function Q(){return Z.value=!0,Promise.all([J(),ae()]).then(([e,t])=>{e&&t&&(l.value=!1)}).finally(()=>{Z.value=!1})}function J(){const e=N.row;if(M.triggerPrice&&w(C.value||"0").gt(0)){const l={type:M.type,size:String(C.value||"0"),triggerPrice:M.triggerPrice.toString()||"0",price:String(M.price||"0"),side:F.value?"SELL":"BUY",contractId:(null==e?void 0:e.contractId)||"",reduceOnly:!0,isPositionTpsl:!0,isSetOpenTp:!1,isSetOpenSl:!1};return te(l).then(e=>(L({type:"success",message:R("setTakeProfitOrderSuccess")}),Promise.resolve(e))).catch(e=>(L({type:"error",message:null==e?void 0:e.message}),Promise.resolve(!1)))}return Promise.resolve(!0)}function ae(){const e=N.row;if(U.triggerPrice&&w(C.value||"0").gt(0)){const l={type:U.type,size:String(C.value||"0"),triggerPrice:U.triggerPrice.toString()||"0",price:String(U.price||"0"),side:F.value?"SELL":"BUY",contractId:(null==e?void 0:e.contractId)||"",reduceOnly:!0,isPositionTpsl:!0,isSetOpenTp:!1,isSetOpenSl:!1};return te(l).then(e=>(L({type:"success",message:R("setStopLossOrderSuccess")}),Promise.resolve(e))).catch(e=>(L({type:"error",message:null==e?void 0:e.message}),Promise.resolve(!1)))}return Promise.resolve(!0)}return(t,a)=>{const i=ne,r=de,o=ce,n=se,s=ue,f=pe,L=me,k=T,J=O,X=c("slider-active");return u(),d(J,{modelValue:l.value,"onUpdate:modelValue":a[23]||(a[23]=e=>l.value=e),"append-to-body":"",title:b(R)("takeProfitStopLoss2"),width:"500px","destroy-on-close":""},{default:p(()=>{var c,T,O,J,G,ee,le;return[m("div",ve,[m("div",ge,[v(g(b(A)[(null==(c=N.row)?void 0:c.contractId)||""])+" ",1),m("div",{class:x(("getColorClass"in t?t.getColorClass:b(P))((null==(T=N.row)?void 0:T.openValue)||"0"))},g(b(w)((null==(O=N.row)?void 0:O.openValue)||0).gt(0)?b(R)("long"):b(R)("short"))+" "+g(b(K))+"X ",3)]),m("div",be,[m("div",fe,[m("label",xe,g(b(R)("entryPrice")),1),v(" "+g(("formatNumber"in t?t.formatNumber:b(h))(b($).toString(),{limit:6,decimals:b(E)})),1)]),m("div",Pe,[m("label",we,g(b(R)("latestPrice")),1),v(" "+g(("formatNumber"in t?t.formatNumber:b(h))(b(j),{limit:20,decimals:b(E)})),1)])]),m("div",he,g(b(R)("stopTips")),1),m("div",null,[y(n,{trigger:"click"},{dropdown:p(()=>[y(o,{class:"[--el-font-size-base:12px]"},{default:p(()=>[y(r,{onClick:a[0]||(a[0]=e=>b(M).type="TAKE_PROFIT_MARKET")},{default:p(()=>[v(g(b(R)("marketStop")),1)]),_:1}),y(r,{onClick:a[1]||(a[1]=e=>b(M).type="TAKE_PROFIT_LIMIT")},{default:p(()=>[v(g(b(R)("limitStop")),1)]),_:1})]),_:1})]),default:p(()=>[m("span",ye,[m("span",null,g("TAKE_PROFIT_MARKET"===b(M).type?b(R)("marketStop"):b(R)("limitStop")),1),y(i)])]),_:1}),m("div",_e,[y(s,{modelValue:b(M).triggerPrice,"onUpdate:modelValue":a[2]||(a[2]=e=>b(M).triggerPrice=e),precision:b(E),controls:!1,align:"left",class:"flex-1",placeholder:b(R)("triggerPrice"),min:b(F)?Number(b(j)):void 0,max:b(F)?void 0:Number(b(j)),onChange:a[3]||(a[3]=e=>function(e){F.value?V.tpPercent=new w(e||0).minus($.value).div($.value).times(K.value).times(100).dp(0,w.ROUND_FLOOR).toNumber():V.tpPercent=new w(e||0).minus($.value).negated().div($.value).times(K.value).times(100).dp(0,w.ROUND_FLOOR).toNumber(),V.tpPercent1=Math.min(Math.max(V.tpPercent,0),200)}(e))},null,8,["modelValue","precision","placeholder","min","max"]),y(s,{modelValue:b(V).tpPercent,"onUpdate:modelValue":[a[4]||(a[4]=e=>b(V).tpPercent=e),a[5]||(a[5]=e=>q(e,1))],modelModifiers:{number:!0},precision:0,controls:!1,align:"left",class:"w-100px text-12px",placeholder:b(R)("returnRate")},{suffix:p(()=>[...a[24]||(a[24]=[v(" % ",-1)])]),_:1},8,["modelValue","placeholder"])]),_(y(f,{modelValue:b(V).tpPercent1,"onUpdate:modelValue":a[6]||(a[6]=e=>b(V).tpPercent1=e),min:0,max:200,step:1,marks:{0:"0%",50:"50%",100:"100%",150:"150%",200:"200%"},class:"mb-30px [&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-456px",onChange:a[7]||(a[7]=e=>q(e))},null,8,["modelValue"]),[[X]]),"TAKE_PROFIT_LIMIT"===b(M).type?(u(),d(s,{key:0,modelValue:b(M).price,"onUpdate:modelValue":a[8]||(a[8]=e=>b(M).price=e),modelModifiers:{number:!0},controls:!1,align:"left",class:"text-12px [&&]:w-full",placeholder:b(R)("price")},null,8,["modelValue","placeholder"])):S("",!0),b(B)?(u(),d(L,{key:1,style:{"--el-alert-title-font-size":"12px","--el-alert-padding":"5px 10px",margin:"10px 0"},title:b(B),type:"success",closable:!1},null,8,["title"])):S("",!0),y(n,{trigger:"click"},{dropdown:p(()=>[y(o,{class:"[--el-font-size-base:12px]"},{default:p(()=>[y(r,{onClick:a[9]||(a[9]=e=>b(U).type="STOP_MARKET")},{default:p(()=>[v(g(b(R)("marketStop2")),1)]),_:1}),y(r,{onClick:a[10]||(a[10]=e=>b(U).type="STOP_LIMIT")},{default:p(()=>[v(g(b(R)("limitStop2")),1)]),_:1})]),_:1})]),default:p(()=>[m("span",Se,[m("span",null,g("STOP_MARKET"===b(U).type?b(R)("marketStop2"):b(R)("limitStop2")),1),y(i)])]),_:1}),m("div",Ie,[y(s,{modelValue:b(U).triggerPrice,"onUpdate:modelValue":a[11]||(a[11]=e=>b(U).triggerPrice=e),controls:!1,align:"left",class:"flex-1",placeholder:b(R)("triggerPrice"),min:b(F)?void 0:Number(b(j)),max:b(F)?Number(b(j)):void 0,onChange:a[12]||(a[12]=e=>function(e){F.value?V.slPercent=new w(e||0).minus($.value).negated().div($.value).times(K.value).times(100).dp(0,w.ROUND_FLOOR).toNumber():V.slPercent=new w(e||0).minus($.value).div($.value).times(K.value).times(100).dp(0,w.ROUND_FLOOR).toNumber(),V.slPercent1=Math.min(Math.max(V.slPercent,0),200)}(e))},null,8,["modelValue","placeholder","min","max"]),y(s,{modelValue:b(V).slPercent,"onUpdate:modelValue":[a[13]||(a[13]=e=>b(V).slPercent=e),a[14]||(a[14]=e=>H(e,1))],modelModifiers:{number:!0},controls:!1,align:"left",class:"w-100px text-12px",placeholder:b(R)("returnRate")},{prefix:p(()=>{var e;return[m("span",Te,g(b(w)((null==(e=b(V))?void 0:e.slPercent)||0).gt(0)?"-":""),1)]}),suffix:p(()=>[...a[25]||(a[25]=[v(" % ",-1)])]),_:1},8,["modelValue","placeholder"])]),_(y(f,{modelValue:b(V).slPercent1,"onUpdate:modelValue":a[15]||(a[15]=e=>b(V).slPercent1=e),min:0,max:200,step:1,marks:{0:"0%",50:"50%",100:"100%",150:"150%",200:"200%"},class:"mb-30px [&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-456px",onChange:a[16]||(a[16]=e=>H(e))},null,8,["modelValue"]),[[X]]),"STOP_LIMIT"===b(U).type?(u(),d(s,{key:2,modelValue:b(U).price,"onUpdate:modelValue":a[17]||(a[17]=e=>b(U).price=e),modelModifiers:{number:!0},controls:!1,align:"left",class:"text-12px [&&]:w-full",placeholder:b(R)("price")},null,8,["modelValue","placeholder"])):S("",!0),b(Y)?(u(),d(L,{key:3,style:{"--el-alert-title-font-size":"12px","--el-alert-padding":"5px 10px",margin:"10px 0"},title:b(Y),type:"error",closable:!1},null,8,["title"])):S("",!0),m("div",Oe,[y(s,{modelValue:b(C),"onUpdate:modelValue":a[18]||(a[18]=e=>I(C)?C.value=e:null),modelModifiers:{number:!0},precision:b(D)<0?0:b(D),step:b(D)<0?10**-b(D):1,"step-strictly":b(D)<0,class:"[&&]:w-full",controls:!1,align:"left",placeholder:b(R)("orderQuantity"),max:Math.abs(Number((null==(J=e.row)?void 0:J.openSize)||"0")),onChange:a[19]||(a[19]=e=>function(e){var l;V.sizePercent=new w(e||0).times(100).div(new w((null==(l=N.row)?void 0:l.openSize)||"0").abs()).dp(0,w.ROUND_FLOOR).toNumber()}(e))},null,8,["modelValue","precision","step","step-strictly","placeholder","max"])]),_(y(f,{modelValue:b(V).sizePercent,"onUpdate:modelValue":a[20]||(a[20]=e=>b(V).sizePercent=e),min:0,max:100,step:1,marks:{0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"},class:"[&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-456px",onChange:a[21]||(a[21]=e=>(e=>{var l,t;D.value<0?C.value=new w(e||0).div(100).times(new w((null==(l=N.row)?void 0:l.openSize)||"0").abs().times(new w(10).pow(D.value))).dp(0,w.ROUND_FLOOR).div(new w(10).pow(D.value)).toNumber():C.value=new w(e||0).div(100).times(new w((null==(t=N.row)?void 0:t.openSize)||"0").abs()).dp(D.value,w.ROUND_FLOOR).toNumber()})(e))},null,8,["modelValue"]),[[X]]),m("div",Le,[m("span",Ne,g(b(R)("positionQty")),1),m("span",null,g(Math.abs(Number((null==(G=N.row)?void 0:G.openSize)||"0")))+" "+g(b(A)[(null==(ee=N.row)?void 0:ee.contractId)||""].replace("USD","")),1)]),m("div",ke,[m("span",ze,g(b(R)("orderQuantity")),1),m("span",null,g(b(C)||"0.0")+" "+g(b(A)[(null==(le=N.row)?void 0:le.contractId)||""].replace("USD","")),1)]),m("div",Re,[y(k,{class:"h-40px flex-1 m-l-auto",color:b(z).isDark?"#333":"#F2F2F2",onClick:a[22]||(a[22]=e=>l.value=!1)},{default:p(()=>[v(g(t.$t("cancel")),1)]),_:1},8,["color"]),y(k,{type:"primary",class:"h-40px flex-1 m-l-auto",disabled:b(W),loading:b(Z),onClick:Q},{default:p(()=>[v(g(t.$t("confirm")),1)]),_:1},8,["disabled","loading"])])])])]}),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-36cd1535"]]),Ve={key:0,class:"color-[--down-color]"},Me={key:1,class:"color-[--up-color]"},Ue={class:"mt-20px flex justify-end"},Fe=e({__name:"stopTable",props:{orderList:{},orderListModifiers:{},visible:{type:Boolean},visibleModifiers:{}},emits:l(["add"],["update:orderList","update:visible"]),setup(e,{emit:l}){const o=a(),n=i(),s=t(e,"orderList"),c=l,x=t(e,"visible"),{t:P}=r(),w={LAST_PRICE:P("latestPrice"),TAKE_PROFIT_LIMIT:P("takeProfitLimit"),LIMIT:P("limit"),MARKET:P("market"),STOP_LIMIT:P("stop_limit"),STOP_MARKET:P("stop_market"),TAKE_PROFIT_MARKET:P("takeProfitMarket")},_=f(()=>{var e,l,t;const a=(null==(t=null==(l=null==(e=o.metadata)?void 0:e.contractList)?void 0:l.reduce)?void 0:t.call(l,(e,l)=>(e[l.contractId]=l.contractName,e),{}))||{};return a.ALL=P("all"),a}),I=async e=>{C.confirm(P("botCancelOrder"),P("cancelOrder"),{confirmButtonText:P("confirm"),cancelButtonText:P("cancel"),type:"warning"}).then(async()=>{var l,t,a,i;const r=e?[e]:(null==(t=null==(l=null==s?void 0:s.value)?void 0:l.map)?void 0:t.call(l,e=>e.id))||[];await V(r),M.success(P("cancelledOrderSuccessfully")),s.value=(null==(i=null==(a=s.value)?void 0:a.filter)?void 0:i.call(a,e=>!r.includes(e.id)))||[]})};return(e,l)=>{const t=J,a=R,i=Q,r=T,o=O;return u(),d(o,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=e=>x.value=e),"append-to-body":"",title:b(P)("stopLimit"),width:"800px","destroy-on-close":""},{default:p(()=>{var o;return[y(i,{data:null==(o=s.value)?void 0:o.toSorted((e,l)=>((null==l?void 0:l.createdTime)||0)-((null==e?void 0:e.createdTime)||0)),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px",fit:""},{default:p(()=>[y(t,{width:"50",label:b(P)("No"),type:"index"},null,8,["label"]),y(t,{align:"right",label:b(P)("orderType"),prop:"orderType"},{default:p(({row:l})=>[l.type.includes("STOP")?(u(),k("span",Ve,g(e.$t("stopLoss")),1)):l.type.includes("PROFIT")?(u(),k("span",Me,g(e.$t("takeProfit")),1)):S("",!0)]),_:1},8,["label"]),y(t,{align:"right",label:b(P)("orderSize"),prop:"size"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(l.size,10))+" "+g(b(_)[l.contractId].replace("USD","")),1)]),_:1},8,["label"]),y(t,{"min-width":"150",align:"right",label:b(P)("triggerPrice"),prop:"triggerPrice"},{default:p(({row:l})=>[v(g(l.triggerSign)+g(("formatNumber"in e?e.formatNumber:b(h))(l.triggerPrice,{limit:20,decimals:10}))+" "+g(w[l.triggerPriceType]),1)]),_:1},8,["label"]),y(t,{align:"right",label:b(P)("price"),prop:"price"},{default:p(({row:l})=>[v(g(l.type.includes("LIMIT")?("formatNumber"in e?e.formatNumber:b(h))(l.price,{decimals:10,limit:20}):b(P)("market")),1)]),_:1},8,["label"]),y(t,{"min-width":"150",align:"right",label:b(P)("orderTime"),prop:"createdTime"},{default:p(({row:e})=>[v(g(b(z)(Number(e.createdTime)).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),y(t,{width:100,align:"right",label:b(P)("action"),prop:"operate"},{default:p(({row:e})=>[y(a,{name:"custom:delete",class:"w-14px h-14px color-[--third-text] cursor-pointer",onClick:l=>I(e.id)},null,8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),m("div",Ue,[y(r,{class:"m-l-auto [&&]:w-88px",color:b(n).isDark?"#333":"#F2F2F2",onClick:l[0]||(l[0]=e=>c("add"))},{default:p(()=>[v(g(e.$t("add")),1)]),_:1},8,["color"]),y(r,{type:"primary",class:"m-l-auto [&&]:w-88px",onClick:l[1]||(l[1]=e=>I())},{default:p(()=>[v(g(e.$t("cancelAll")),1)]),_:1})])]}),_:1},8,["modelValue","title"])}}}),Ae={class:"flex items-center font-bold h-21px mb-16px"},Ee={class:"flex items-center justify-between mb-16px"},De={class:"color-[--third-text]"},Ke={class:"color-[--main-text]"},je={class:"color-[--third-text] mb-8px"},$e={class:"color-[--third-text] justify-between mb-8px"},Be={class:"color-[--third-text] flex justify-between mt-38px mb-8px"},Ye={class:"flex mt-20px text-16px"},qe=N(e({__name:"closePosition",props:l({row:{},token:{}},{visible:{type:Boolean},visibleModifiers:{}}),emits:["update:visible"],setup(e){const l=e,a=i(),N=t(e,"visible"),{t:z}=r(),R=s({closePrice:void 0,closeSize:void 0});o(N,e=>{e&&(R.closePrice=$.value,R.closeSize=w(j.value||"0").abs().times(new w(10).pow(E.value)).dp(0,w.ROUND_FLOOR).div(new w(10).pow(E.value)).toNumber(),C.value=100)});const C=n(0),V=f(()=>"limit"===l.row.operation),M=f(()=>V.value?z("limitClose"):z("marketClose")),A=f(()=>X(l.row.contractId||"")),E=f(()=>G(l.row.contractId||"")),D=f(()=>le.getSymbolModel(l.row.contractId)),K=f(()=>ee(l.row.contractId)||"1"),j=f(()=>l.row.openSize||"0"),$=f(()=>{var e;return(null==(e=D.value)?void 0:e.lastPrice)||"0"});const B=f(()=>{const e=l.row,t=(V.value?R.closePrice:$.value)||"0";if(!e||new w(t).isZero())return"0";return(Number(null==e?void 0:e.openSize)>=0?new w(t).times(new w((null==e?void 0:e.openSize)||0).abs()).minus(new w(e.openValue).abs()):new w(e.openValue||0).abs().minus(new w(t).times(new w(e.openSize).abs()))).dp(2,w.ROUND_FLOOR)}),Y=n(!1),q=f(()=>new w(R.closeSize||0).isZero()||V.value&&new w(R.closePrice||0).isZero());function H(){const e=l.row;if(R.closePrice&&w(R.closeSize||"0").gt(0)){const l={type:V.value?"LIMIT":"MARKET",size:String(R.closeSize||"0"),price:String(R.closePrice||"0"),side:w((null==e?void 0:e.openSize)||"0").gte(0)?"SELL":"BUY",contractId:(null==e?void 0:e.contractId)||"",reduceOnly:!0,isPositionTpsl:!1,isSetOpenTp:!1,isSetOpenSl:!1};Y.value=!0,te(l).then(e=>{L({type:"success",message:V.value?z("limitPriceClosePosition"):z("closePositionSubmitted")}),N.value=!1}).catch(e=>{L({type:"error",message:null==e?void 0:e.message})}).finally(()=>{Y.value=!1})}}return(t,i)=>{const r=ue,o=pe,n=T,s=O,f=c("slider-active");return u(),d(s,{modelValue:N.value,"onUpdate:modelValue":i[7]||(i[7]=e=>N.value=e),"append-to-body":"",title:b(M),width:"450px","destroy-on-close":""},{default:p(()=>{var s;return[m("div",Ae,[v(g(l.token)+" · "+g(b(z)("all2")),1),m("span",{class:x(["ml-4px font-normal",("getColorClass"in t?t.getColorClass:b(P))(l.row.openValue)])},g(b(w)(l.row.openValue||0).gt(0)?b(z)("long"):b(z)("short"))+" · "+g(b(K))+"X ",3)]),m("div",Ee,[m("span",De,g(b(z)("latestPrice")),1),m("span",Ke,g(("formatNumber"in t?t.formatNumber:b(h))(b($),{limit:20,decimals:b(A)}))+" USD",1)]),b(V)?(u(),k(U,{key:0},[m("div",je,g(b(z)("closePrice")),1),y(r,{modelValue:b(R).closePrice,"onUpdate:modelValue":i[1]||(i[1]=e=>b(R).closePrice=e),precision:b(A),align:"left",controls:!1,min:0,class:"mb-16px w-full!"},{suffix:p(()=>[i[8]||(i[8]=m("span",{class:"color-[--third-text] mx-4px"},"|",-1)),m("span",{class:"color-[--up-color] clickable",onClick:i[0]||(i[0]=F(e=>b(R).closePrice=b($),["stop"]))},g(b(z)("midPrice")),1)]),_:1},8,["modelValue","precision"])],64)):S("",!0),m("div",$e,g(b(z)("closeSize")),1),y(r,{modelValue:b(R).closeSize,"onUpdate:modelValue":i[2]||(i[2]=e=>b(R).closeSize=e),precision:b(E)<0?0:b(E),step:b(E)<0?10**-b(E):1,"step-strictly":b(E)<0,align:"left",controls:!1,class:"mb-12px w-full!",max:Math.abs(Number((null==(s=e.row)?void 0:s.openSize)||"0")),onChange:i[3]||(i[3]=e=>function(e){var t;C.value=new w(e||0).times(100).div(new w((null==(t=l.row)?void 0:t.openSize)||"0").abs()).dp(0,w.ROUND_FLOOR).toNumber()}(e))},null,8,["modelValue","precision","step","step-strictly","max"]),_(y(o,{modelValue:b(C),"onUpdate:modelValue":i[4]||(i[4]=e=>I(C)?C.value=e:null),min:0,max:100,step:1,marks:{0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"},class:"[&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-406px",onInput:i[5]||(i[5]=e=>(e=>{var t;R.closeSize=new w(e||0).div(100).times(new w((null==(t=l.row)?void 0:t.openSize)||"0").abs()).dp(E.value,w.ROUND_FLOOR).toNumber()})(e))},null,8,["modelValue"]),[[f]]),m("div",Be,[v(g(b(z)("estimatedPL"))+" ",1),m("span",{class:x(b(w)(b(B)).gte(0)?"color-[--up-color]":"color-[--down-color]")},g(b(B))+" USD",3)]),m("div",Ye,[y(n,{class:"h-40px flex-1 m-l-auto",color:b(a).isDark?"#333":"#F2F2F2",onClick:i[6]||(i[6]=F(e=>N.value=!1,["stop"]))},{default:p(()=>[v(g(t.$t("cancel")),1)]),_:1},8,["color"]),y(n,{type:"primary",class:"h-40px flex-1 m-l-auto",disabled:b(q),loading:b(Y),onClick:F(H,["stop"])},{default:p(()=>[v(g(t.$t("confirm")),1)]),_:1},8,["disabled","loading"])])]}),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-d904563a"]]),He={class:"relative min-h-400px bg-[--secondary-bg]"},Ze={class:"text-12px"},We={key:1},Qe={class:"flex items-center text-14px lh-18px color-[--main-text] gap-4px mb-4px"},Je={key:0,class:"flex items-center gap-2px [&>span]:bg-[#3b3b3b] data-[active=on]:[&>span:nth-child(1)]:bg-[#08BA4E] data-[active=on]:[&>span:nth-child(2)]:bg-[#409F4B] data-[active=on]:[&>span:nth-child(3)]:bg-[#7F8147] data-[active=on]:[&>span:nth-child(4)]:bg-[#B36844] data-[active=on]:[&>span:nth-child(5)]:bg-[#F1493F]"},Xe=["data-active"],Ge={class:"text-12px lh-18px flex flex-col gap-4px"},el={__name:"holding",props:{searchParams:{type:Object,default:()=>({})}},setup(e){const l=e;let t={id:null};const{t:i}=r(),s=a(),O=A(),L=$({}),N=n(!1),z=n(null),R=n(!1),C=n(!1),V=f(()=>{var e,l,t;const a=(null==(t=null==(l=null==(e=s.metadata)?void 0:e.contractList)?void 0:l.reduce)?void 0:t.call(l,(e,l)=>(e[l.contractId]=l.contractName,e),{}))||{};return a.ALL=i("all"),a}),M=f(()=>{var e;return(null==(e=s.position)?void 0:e.filter(e=>{var t,a,i;return(null==(t=null==l?void 0:l.searchParams)?void 0:t.filterContractIdList)&&e.contractId===(null==(a=null==l?void 0:l.searchParams)?void 0:a.filterContractIdList)||!(null==(i=l.searchParams)?void 0:i.filterContractIdList)}))||[]});o(()=>O.wsResult[E.TICKER_ALL_1S],e=>{s.position.forEach(l=>{var t,a,i;const r=null==(a=null==(t=e.data)?void 0:t.find)?void 0:a.call(t,e=>e.contractId===l.contractId);if(r){l.oraclePrice=r.oraclePrice;const e=(null==r?void 0:r.lastPrice)||(null==r?void 0:r.oraclePrice)||"0",t=Number(null==l?void 0:l.openSize)>=0?new w(e).times(new w((null==l?void 0:l.openSize)||0).abs()).minus(new w(l.openValue).abs()):new w(l.openValue||0).abs().minus(new w(e).times(new w(l.openSize).abs()));l.unrealizedPnl=t.dp(2,w.ROUND_FLOOR).toString(),l.unrealizedPnlRate=null==(i=ae(l.contractId))?void 0:i.unrealizedPnlRoe}})}),o(()=>{var e;return null==(e=s.totalAssets)?void 0:e.accountList},e=>{var l;if(e){const t=(null==(l=null==e?void 0:e[0])?void 0:l.positionAssetList)||[];s.position.forEach(e=>{const l=t.find(l=>l.contractId===e.contractId);l&&(e.maxLeverage=l.maxLeverage,e.liquidatePrice=l.liquidatePrice)})}},{immediate:!0});const F=async()=>{const e=await H();L.value=(null==e?void 0:e.positionContractIdToLightNumberMap)||{}},Z=f(()=>{var e,l,t,a,i;return(null==(e=z.value)?void 0:e.contractId)?null==(i=null==(a=(null==(t=null==(l=s.order)?void 0:l.filter)?void 0:t.call(l,e=>{var l;return e.contractId===(null==(l=z.value)?void 0:l.contractId)&&["TAKE_PROFIT_LIMIT","STOP_LIMIT","TAKE_PROFIT_MARKET","STOP_MARKET"].includes(e.type)}))||[])?void 0:a.toSorted)?void 0:i.call(a,(e,l)=>l.createdTime-e.createdTime):[]}),W=(e,l)=>{C.value=!0,z.value={...e,operation:l}},G=()=>{R.value=!1,N.value=!0};return D(()=>{O.send({type:"unsubscribe",channel:"ticker.all.1s"}),setTimeout(()=>{O.send({type:"subscribe",channel:"ticker.all.1s"})},500),F(),t=K(5e3,()=>{F()})}),j(()=>{t.id&&cancelAnimationFrame(t.id)}),(e,l)=>{var t;const a=q,r=J,o=T,n=Q,f=c("tooltip");return u(),k(U,null,[m("div",He,[y(n,{fit:"",data:b(M),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px"},{empty:p(()=>{var l;return[0===(null==(l=b(s).position)?void 0:l.length)?(u(),d(a,{key:0,class:"pt-[40px]"},{default:p(()=>[m("span",Ze,g(e.$t("emptyNoData")),1)]),_:1})):(u(),k("span",We))]}),default:p(()=>[y(r,{label:b(i)("markets1"),prop:"perp"},{default:p(({row:l})=>[m("div",Qe,[v(g(b(V)[l.contractId])+" ",1),"number"==typeof b(L)[l.contractId]?_((u(),k("div",Je,[(u(),k(U,null,B(5,e=>m("span",{key:e,class:"w-2px h-10px","data-active":b(L)[l.contractId]>e?"on":"off"},null,8,Xe)),64))])),[[f,b(i)("autoDeleverageTips")]]):S("",!0)]),m("div",{class:x(["text-10px lh-14px",("getColorClass"in e?e.getColorClass:b(P))(l.openValue)])},g(l.openValue>0?b(i)("long"):b(i)("short"))+" "+g(b(ee)(l.contractId)||l.maxLeverage)+"x ",3)]),_:1},8,["label"]),y(r,{width:100,label:b(i)("Qty"),prop:"openSize"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(l.openSize.replace("-",""))),1)]),_:1},8,["label"]),y(r,{align:"right",label:b(i)("contractValue"),prop:"openValue"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(l.oraclePrice?new(b(w))(l.openSize).multipliedBy(l.oraclePrice).toString().replace("-",""):l.openValue.replace("-",""),{limit:20,decimals:4})),1)]),_:1},8,["label"]),y(r,{align:"right",label:b(i)("entryPrice"),prop:"entryPrice"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(new(b(w))(l.openValue).div(l.openSize).toString(),{limit:20,decimals:("getPricePrecision"in e?e.getPricePrecision:b(X))(l.contractId),decimalsHasZero:!0})),1)]),_:1},8,["label"]),y(r,{align:"right",label:b(i)("oraclePrice"),prop:"oraclePrice"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(l.oraclePrice,{limit:20,decimals:("getPricePrecision"in e?e.getPricePrecision:b(X))(l.contractId),decimalsHasZero:!0})),1)]),_:1},8,["label"]),y(r,{align:"right",label:b(i)("estimatedLiquidationPrice"),prop:"liquidatePrice"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(("getPositionLiqPrice"in e?e.getPositionLiqPrice:b(ie))(l.contractId)||l.liquidatePrice,{limit:20,decimals:("getPricePrecision"in e?e.getPricePrecision:b(X))(l.contractId),decimalsHasZero:!0})),1)]),_:1},8,["label"]),y(r,{align:"right",label:b(i)("unrealizedPnl"),prop:"unrealizedPnl"},{default:p(({row:l})=>[m("div",Ge,[m("span",{class:x(("getColorClass"in e?e.getColorClass:b(P))(l.unrealizedPnl))},g(("addSign"in e?e.addSign:b(Y))(l.unrealizedPnl))+g(("formatNumber"in e?e.formatNumber:b(h))(Math.abs(l.unrealizedPnl),2)),3),m("span",{class:x(("getColorClass"in e?e.getColorClass:b(P))(l.unrealizedPnlRate))},"("+g(("addSign"in e?e.addSign:b(Y))(l.unrealizedPnlRate))+g(("formatNumber"in e?e.formatNumber:b(h))(Math.abs(l.unrealizedPnlRate),2))+"%)",3)])]),_:1},8,["label"]),y(r,{align:"right",label:b(i)("fundingFee"),prop:"fundingFee"},{default:p(({row:l})=>[v(g(("formatNumber"in e?e.formatNumber:b(h))(l.fundingFee,("getPricePrecision"in e?e.getPricePrecision:b(X))(l.contractId))),1)]),_:1},8,["label"]),y(r,{width:150,align:"right",label:b(i)("takeProfitStopLoss"),prop:"takeProfitStopLoss"},{default:p(({row:l})=>{var t,a;return[(null==(a=null==(t=b(s).order)?void 0:t.some)?void 0:a.call(t,e=>(null==e?void 0:e.contractId)===(null==l?void 0:l.contractId)))?(u(),d(o,{key:0,size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>(e=>{z.value=e,R.value=!0})(l)},{default:p(()=>[v(g(e.$t("detail")),1)]),_:1},8,["onClick"])):S("",!0),y(o,{size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>(e=>{z.value=e,N.value=!0})(l)},{default:p(()=>[v(" + "+g(e.$t("add")),1)]),_:1},8,["onClick"])]}),_:1},8,["label"]),y(r,{width:150,align:"right",label:b(i)("action"),prop:"closePosition"},{default:p(({row:l})=>[y(o,{size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>W(l,"limit")},{default:p(()=>[v(g(e.$t("limit")),1)]),_:1},8,["onClick"]),y(o,{size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>W(l,"market")},{default:p(()=>[v(g(e.$t("market")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),y(Ce,{visible:b(N),"onUpdate:visible":l[0]||(l[0]=e=>I(N)?N.value=e:null),row:b(z)},null,8,["visible","row"]),y(Fe,{visible:b(R),"onUpdate:visible":l[1]||(l[1]=e=>I(R)?R.value=e:null),orderList:b(Z),onAdd:G},null,8,["visible","orderList"]),y(qe,{visible:b(C),"onUpdate:visible":l[2]||(l[2]=e=>I(C)?C.value=e:null),token:b(V)[null==(t=b(z))?void 0:t.contractId]||"",row:b(z)||{}},null,8,["visible","token","row"])],64)}}},ll={class:"flex items-center justify-center w-[calc(100vw-100px)]"},tl={class:"text-12px mr-10px"},al=e({__name:"withdrawAlert",setup(e){const l=a(),{t:t}=r(),{isCanNormalWithdrawableAmount:i}=re();function o(){Z().then(e=>{l.normalWithdrawableAmount=(null==e?void 0:e.amount)||"0"}).catch(e=>{l.normalWithdrawableAmount="0"})}const s=n(!1);function c(){s.value=!0,oe().then(e=>e.wait()).then(e=>{o(),L({type:"success",message:t("claimedSuccess")})}).catch(e=>{W(e)}).finally(()=>{s.value=!1})}return D(()=>{o()}),(e,t)=>{const a=T,r=me;return b(i)?(u(),d(r,{key:0,type:"success",closable:!1,style:{"--el-alert-icon-large-size":"20px"}},{default:p(()=>[m("div",ll,[m("span",tl,g(e.$t("canPerpWithdraw",{n:("formatNumber"in e?e.formatNumber:b(h))(b(l).normalWithdrawableAmount,3)})),1),y(a,{type:"primary",size:"small",loading:b(s),onClick:c},{default:p(()=>[v(g(e.$t("claim")),1)]),_:1},8,["loading"])])]),_:1})):S("",!0)}}});export{el as _,al as a};
