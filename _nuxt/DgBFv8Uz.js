import{n as a,bv as e,aw as l,gg as t,D as r,F as i,at as s,M as o,ff as n,c as u,o as c,b as d,a as m,w as p,J as f,t as b,E as g,K as v,cN as h,d as C,a8 as x,a5 as w,cX as y,ap as S,H as N,aJ as z,S as _,bz as D,qo as I}from"./C8zCCogY.js";import{E as O,a as M}from"./C-cIFx6x.js";import"./Dwz_iTym.js";import"./pAvqTbq1.js";import"./2xvRo4QC.js";const V=["infinite-scroll-disabled"],P={class:"text-12px"},Y={key:1},k={class:"text-14px"},B={class:"mt-[2px] mb-[5px] py-[10px] text-[12px] text-center color-[--third-text]"},L={key:0},H=a({__name:"positionHistory",props:{searchParams:{}},setup(a){const H=e(),T=a,{t:j}=l(),A=t(),E=s([]),J=i({loading:!1,finished:!1,error:!1}),U=i(""),q=g(()=>{var a,e,l;const t=(null==(l=null==(e=null==(a=A.metadata)?void 0:a.contractList)?void 0:e.reduce)?void 0:l.call(e,(a,e)=>(a[e.contractId]=e.contractName,a),{}))||{};return t.ALL=j("all"),t}),F=a=>Math.abs(a.cumOpenSize)!==Math.abs(a.cumCloseSize),K=a=>{var e;const l=(null==(e=A.position.find(e=>e.contractId===a.contractId))?void 0:e.openValue)||0,t=new D(0).minus(a.cumOpenValue).minus(a.cumCloseValue);return F(a)?t.plus(l):t},Q=a=>{var e;const l=K(a);if(!a.currentLeverage)return new D(0);{const t=(null==(e=A.position.find(e=>e.contractId===a.contractId))?void 0:e.openValue)||0,r=F(a)?new D(a.cumOpenValue).abs().minus(new D(t).abs()):new D(a.cumOpenValue).abs();return r.isZero()?new D(0):l.dividedBy(r).multipliedBy(100).multipliedBy(a.currentLeverage)}},X=async()=>{var a,e;if(J.value.loading||J.value.finished)return;const l={...T.searchParams};U.value&&(l.offsetData=U.value);try{J.value.loading=!0;const t=await I(l);let r=(null==(e=null==(a=t.dataList)?void 0:a.filter)?void 0:e.call(a,a=>Math.abs(a.cumCloseSize)>0))||[];U.value&&(r=E.value.concat(r)),t.nextPageOffsetData||(J.value.finished=!0),U.value=t.nextPageOffsetData,E.value=r}catch(t){J.value.error=!0}finally{J.value.loading=!1}};H.address&&X();const Z=a=>{var e,l;const t=(null==(l=null==(e=A.contractList)?void 0:e.find(e=>e.contractId===a.contractId))?void 0:l.oraclePrice)||0;return D(a.openSize).multipliedBy(t).minus(a.openValue).toString()},$=a=>{const e=Z(a);return D(e).dividedBy(D(a.openValue).abs()).multipliedBy(100).multipliedBy(a.leverage).toString()};return r(()=>[T.searchParams,H.address],()=>{U.value="",E.value=[],J.value.finished=!1,J.value.error=!1,J.value.loading=!1,X()}),(a,e)=>{const l=z,t=O,r=M,i=n;return o((c(),u("div",{class:"relative min-h-400px bg-[--secondary-bg]","infinite-scroll-delay":200,"infinite-scroll-disabled":f(J).loading||f(J).finished||f(J).error,"infinite-scroll-immediate":!1,"infinite-scroll-distance":300},[d(r,{fit:"",data:f(E),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px"},{empty:p(()=>{var e;return[f(J).loading||0!==(null==(e=f(E))?void 0:e.length)?(c(),u("span",Y)):(c(),N(l,{key:0,class:"pt-[40px]"},{default:p(()=>[m("span",P,b(a.$t("emptyNoData")),1)]),_:1}))]}),default:p(()=>[d(t,{label:f(j)("markets1"),prop:"contractId"},{default:p(({row:e})=>[m("span",k,b(f(q)[e.contractId]),1),m("div",{class:v(["text-10px lh-14px",("getColorClass"in a?a.getColorClass:f(h))(e.cumOpenSize)])},b(e.cumOpenSize>0?f(j)("long"):f(j)("short")),3)]),_:1},8,["label"]),d(t,{label:f(j)("Qty"),prop:"contractSize"},{default:p(({row:e})=>[C(b(Math.abs(+("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenSize)||0))+" "+b(f(q)[e.contractId].replace("USD","")),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("closeSize")},{default:p(({row:e})=>[C(b(Math.abs(+("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseSize)||0))+" "+b(f(q)[e.contractId].replace("USD","")),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("status")},{default:p(({row:a})=>[C(b(F(a)?f(j)("partialClose"):f(j)("closed")),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("openAvgPrice")},{default:p(({row:e})=>[C(b(("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenValue/e.cumOpenSize,{limit:20,decimals:2})),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("avgPrice2")},{default:p(({row:e})=>[C(b(("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseValue/e.cumCloseSize,{limit:20,decimals:2})),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("unrealizedPnl")},{default:p(({row:e})=>[F(e)?(c(),u(w,{key:0},[m("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(h))(Z(e))])},b(("formatNumber"in a?a.formatNumber:f(x))(Z(e),2)),3),m("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(h))($(e))])},b(("formatNumber"in a?a.formatNumber:f(x))($(e),{limit:20,decimals:2}))+"% ",3)],64)):(c(),u(w,{key:1},[C("--")],64))]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("pnl")},{default:p(({row:e})=>[m("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(h))(K(e).toString())])},b(("formatNumber"in a?a.formatNumber:f(x))(K(e).toString())),3),m("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(h))(Q(e).toString())])},b(("formatNumber"in a?a.formatNumber:f(x))(Q(e).toString(),{limit:20,decimals:2}))+"% ",3)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("termCount")},{default:p(({row:e})=>[C(b(F(e)?"--":("formatCountdown"in a?a.formatCountdown:f(y))(0,!1,f(S)(+e.updatedTime).diff(f(S)(+e.createdTime),"s"))),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("openTime2")},{default:p(({row:a})=>[C(b(f(S)(+a.createdTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),d(t,{align:"right",label:f(j)("lastCloseTime")},{default:p(({row:a})=>[C(b(f(S)(+a.updatedTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"])]),_:1},8,["data"]),m("div",B,[f(J).loading&&f(U)?(c(),u("span",L,b(f(j)("loading")),1)):_("",!0)])],8,V)),[[i,X]])}}});export{H as default};
