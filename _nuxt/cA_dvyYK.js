import{n as e,aw as l,br as a,bB as t,bt as o,bv as s,bu as n,c9 as i,c as u,H as r,o as d,a5 as c,b as v,S as m,T as p,ak as b,L as y,K as f,J as g,at as w,w as x,a as k,aa as h,t as B,ac as S,cA as T,aM as V,aU as _,d as A,M as q,P as F,cL as N,bz as z,aN as C,dm as I,by as L,bs as M,dn as $,dp as j,dq as E,D as G,dr as U,ds as P,dt as R}from"./C8zCCogY.js";import{u as W}from"./DNd1VKJp.js";import{r as D,u as O}from"./BWc5ynOe.js";const H={class:"m-text"},J={key:0,class:"ml-5px"},K={class:"text-20px"},Q={class:"min-h-60px py-10px"},X={class:"text-16px"},Y={class:"flex mt-10px"},Z={class:"m-text"},ee={key:0,class:"ml-5px"},le=e({__name:"quickSwap",props:{quickBuyValue:{},swapSetSelected:{default:void 0},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},size:{default:"14px"},buttonType:{default:0}},emits:["submitSwap","jump"],setup(e,{emit:le}){const{walletSwap:ae,loadingWalletSwap:te}=W(),{t:oe}=l(),se=e,ne=a(),ie=w(!1),ue=w(!1),re=w(""),de=t("noReminderQuickBuy",!1),ce=le;function ve(){var e;if(ce("submitSwap"),!N())return;if(ie.value)return;if(1===se.buttonType&&new z(se.quickBuyValue||0).lte(0))return void C({type:"error",plain:!0,message:oe("buyAmountMustG0"),duration:1e3});if(new z(se.quickBuyValue||0).lte(0))return void I({title:"Error",type:"error",message:oe("amountMustG0")});const{row:l}=se;re.value=oe("quickBuyMsg",{a:se.quickBuyValue,m:(null==(e=S(se.row.chain))?void 0:e.main_name)||"",s:l.symbol||(l.target_token==l.token0_address?l.token0_symbol:l.token1_symbol)}),de.value||1===se.buttonType?ye():ue.value=!0}const me=w(),pe=o(),be=s();async function ye(){var e;if(be.provider&&be.address&&!ne.evmAddress)return void async function(){const e=new z(se.quickBuyValue||0).toFixed();ae(e,se.row)}();ue.value=!1;const{chain:l}=se.row;ie.value=!0,await async function(e){var l,a,t,o;const s=ne.getWalletAddress(e);if(!s)return;const n=null==(l=ne.userInfo.addresses.find(l=>l.chain===e))?void 0:l.balance;let i={chain:e,token:$(e),address:$(e),decimals:null==(a=S(e))?void 0:a.decimals,symbol:null==(t=S(e))?void 0:t.main_name};if(n)return void(me.value={...i,balance:n});if(be.address&&!ne.evmAddress){const l=await U({chain:e,tokens:[$(e)],walletAddress:s});i=(null==l?void 0:l[0])||{},me.value={...i,symbol:null==(o=S(e))?void 0:o.main_name,chain:e,address:i.token||i.address,decimals:i.decimals||i.decimal}}}(l);const a=me.value,t=null==(e=new z(se.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(t)||0)<=0?(I({title:"Error",type:"error",message:oe("amountTooSmall")}),void(ie.value=!1)):new z(t||0).gt((null==a?void 0:a.balance)||0)&&void 0!==(null==a?void 0:a.balance)?(I({title:"Error",type:"error",message:oe("insufficientBalance")}),void(ie.value=!1)):void async function(e){var l,a,t,o,s;const{chain:n}=se.row,i="solana"===n,{botSettings:u}=pe,r=se.swapSetSelected||(null==(a=null==(l=null==u?void 0:u[n])?void 0:l.buy)?void 0:a.selected),d=null==(o=null==(t=null==u?void 0:u[n])?void 0:t.buy)?void 0:o[r],{gasTip1List:c,gasTip2List:v}=L(M().gasTip,n),m=(null==d?void 0:d.mev)?c:v,p=(null==d?void 0:d.mev)?null==d?void 0:d.gas[0]:null==(s=null==d?void 0:d.gas)?void 0:s[1];let b={};if(i){let e=(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"0.002";(null==d?void 0:d.mev)&&new z(e).lt("0.002")&&(e="0.002"),b.priorityFee=new z(e).times(10**9).toFixed(0)}else if("ton"!==n){const e=0===Number(null==p?void 0:p.customFee)?"0":(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"3";b.gasTip=Number(new z(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=n}const y=$(n),f=(null==d?void 0:d.slippage)||"9",g=ne.getWalletAddress(n);if(!g)return;const w=Date.now().toString();b={...b,swapList:[{batchId:w,creatorAddress:g,inAmount:new z(e||0).times(10**me.value.decimals||0).toFixed(0)}],inTokenAddress:y,outTokenAddress:se.row.token||se.row.target_token,swapType:1,isPrivate:(null==d?void 0:d.mev)||!1,slippage:"auto"!==f?Number(new z(f).times(100).toFixed(0)):900,autoSell:pe.autoSellConfig_autoSell||!1,autoSellConfig:null==pe?void 0:pe.selectedAutoSellConfig,autoGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellPriorityFee:i?b.priorityFee:b.gasTip};let x=j;i?x=P:"ton"===n&&(x=R);x(b).then(e=>function(e,l){if(e){let a=setTimeout(()=>{fe.placeOrderUpdate++,ie.value=!1},500);const t=se.row.chain,o=(null==e?void 0:e[0])||{},s={solana:"/botapi/swap/createSolTx",ton:"/botapi/swap/createSwapTonTx"};D({txInfo:o,chain:t,destination:(null==s?void 0:s[t])||"/botapi/swap/createSwapEvmTx",type:10});const n={[null==o?void 0:o.batchId]:null==o?void 0:o.id},i=G(()=>ge.wsResult.tgbot,e=>{var t,o,s,u,r;const d=e.batchId;if(d===l){if(a&&(clearTimeout(a),a=null),fe.placeOrderSuccess++,null==(o=null==(t=null==e?void 0:e.txList)?void 0:t[0])?void 0:o.success){I({type:"success",message:oe("tradeSuccess")}),ce("jump");const l=null==(s=null==e?void 0:e.txList)?void 0:s[0];O({...l,chain:null==e?void 0:e.chain},(null==n?void 0:n[d])||"")}else E((null==(r=null==(u=null==e?void 0:e.txList)?void 0:u[0])?void 0:r.failMessage)||"swap error");i(),ie.value=!1}})}}(e,w)).catch(e=>{E(e||"swap error"),ie.value=!1})}(t)}const fe=n(),ge=i();return(l,a)=>{const t=h,o=p,s=_,n=T;return 0===e.buttonType?(d(),u(c,{key:0},[v(o,{disabled:!Number(e.quickBuyValue),loading:g(ie)||g(te),color:e.buttonBg,class:f(["flex items-center [&&]:px-8px [&&]:py-5px [&&]:h-auto",e.classNames]),style:y([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:b(ve,["stop","prevent"])},{default:x(()=>{var a;return[g(ie)||g(te)?m("",!0):(d(),r(t,{key:0,style:y({"font-size":e.size}),class:"mr-4px",name:"mynaui:lightning-solid"},null,8,["style"])),k("div",H,[k("span",null,B(e.quickBuyValue||0),1),e.mainNameVisible?(d(),u("span",J,B((null==(a=("getChainInfo"in l?l.getChainInfo:g(S))(e.row.chain))?void 0:a.main_name)||""),1)):m("",!0)])]}),_:1},8,["disabled","loading","color","class","style"]),g(ue)?(d(),r(n,{key:0,modelValue:g(ue),"onUpdate:modelValue":a[1]||(a[1]=e=>V(ue)?ue.value=e:null),title:l.$t("buy"),width:"400px","append-to":e.appendTo,"destroy-on-close":""},{header:x(()=>[k("span",K,B(l.$t("buy")),1)]),footer:x(()=>[v(o,{type:"primary",class:"w-full",size:"large",onClick:b(ye,["stop"])},{default:x(()=>[A(B(l.$t("confirm1")),1)]),_:1})]),default:x(()=>[k("div",Q,[k("div",X,B(g(re)),1),k("div",Y,[v(s,{modelValue:g(de),"onUpdate:modelValue":a[0]||(a[0]=e=>V(de)?de.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:l.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])]),_:1},8,["modelValue","title","append-to"])):m("",!0)],64)):(d(),r(o,{key:1,loading:g(ie)||g(te),color:e.buttonBg,class:f(["flex items-center [&&]:px-4px",e.classNames]),style:y([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:b(ve,["stop","prevent"])},{default:x(()=>{var a;return[q(v(t,{class:"mr-4px text-12px",name:"mynaui:lightning-solid"},null,512),[[F,!g(ie)]]),k("div",Z,[A(B(Number(e.quickBuyValue)?e.quickBuyValue||0:l.$t("buy"))+" ",1),e.mainNameVisible&&Number(e.quickBuyValue)?(d(),u("span",ee,B((null==(a=("getChainInfo"in l?l.getChainInfo:g(S))(e.row.chain))?void 0:a.main_name)||""),1)):m("",!0)])]}),_:1},8,["loading","color","class","style"]))}}});export{le as _};
